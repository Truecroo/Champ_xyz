<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Selfie Cubes — камера → 3D кубы</title>

  <!-- three.js -->
  <script src="https://unpkg.com/three@0.157.0/build/three.min.js"></script>

  <!-- TFJS + PoseNet + ml5 -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.18.0/dist/tf.min.js"></script>
  <script src="https://unpkg.com/@tensorflow-models/posenet@2.2.2/dist/posenet.min.js"></script>
  <script src="https://unpkg.com/ml5@0.12.2/dist/ml5.min.js"></script>

  <style>
    :root { color-scheme: dark; }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; background:#000; color:#fff;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    #app { position: fixed; inset: 0; display: grid; grid-template-rows: auto 1fr auto; }
    header { display:flex; align-items:center; justify-content:space-between; padding:12px 16px;
      border-bottom:1px solid #171717; background:rgba(0,0,0,.4); backdrop-filter:blur(6px); }
    header h1 { margin:0; font-size:14px; font-weight:600; opacity:.9; }
    main { position: relative; }
    #container { position:absolute; inset:0; }
    footer { display:flex; gap:8px; justify-content:center; align-items:center; padding:16px; }
    .btn { appearance:none; border:1px solid #333; background:#0f0f0f; color:#fff;
      padding:10px 14px; border-radius:10px; font-weight:600; cursor:pointer; }
    .btn.primary { background:#fff; color:#000; border-color:#fff; }
    #status { font-size:12px; opacity:.85; text-align:center; padding:6px 12px; }
    #overlay { position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
      background:rgba(0,0,0,.85); }
    .card { background:#0d0d0d; border:1px solid #222; border-radius:14px; padding:16px; max-width:520px; text-align:center; }
    .card h2 { margin:0 0 8px; font-size:18px; }
    .note { font-size:12px; opacity:.85; }
    video { position: fixed; left:-9999px; width:0; height:0; opacity:0; }
    .sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0; }
  </style>
</head>
<body>
<div id="app">
  <header>
    <h1>Selfie Cubes · PoseNet + Three.js</h1>
    <button id="btnInfo" class="btn" title="Информация">Инфо</button>
  </header>

  <main>
    <div id="container" aria-label="3D полотно"></div>

    <div id="overlay" role="dialog" aria-modal="true">
      <div class="card">
        <h2>Дай доступ к камере</h2>
        <p>Мы собираем кубики из видео с фронталки. Ничего никуда не отправляется — всё локально в браузере.</p>
        <p class="note">Если открыл через встроенный браузер (Telegram/IG/VK) — «Открыть в браузере», затем Safari/Chrome.</p>
        <div style="display:flex; gap:8px; justify-content:center; margin-top:12px;">
          <button id="btnStart" class="btn primary">Разрешить камеру</button>
        </div>
      </div>
    </div>

    <!-- скрытые поверхности для текстур -->
    <video id="video" autoplay playsinline muted></video>
    <canvas id="cNose"  width="300" height="300" class="sr-only"></canvas>
    <canvas id="cEyeL"  width="300" height="300" class="sr-only"></canvas>
    <canvas id="cEyeR"  width="300" height="300" class="sr-only"></canvas>
    <canvas id="cMouth" width="300" height="150" class="sr-only"></canvas>
  </main>

  <footer>
    <button id="btnShuffle" class="btn">Перемешать</button>
    <button id="btnCapture" class="btn primary">Снимок</button>
  </footer>
</div>

<p id="status" aria-live="polite"><
