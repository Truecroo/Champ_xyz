<!DOCTYPE html>
<html lang="ru">
<head>
Â  <meta charset="utf-8" />
Â  <title>ĞšÑƒĞ±-ÑĞµĞ»Ñ„Ğ¸</title>
Â  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

Â  Â  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

Â  Â  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>

Â  Â  <script src="https://unpkg.com/ml5@0.12.2/dist/ml5.min.js"></script>

Â  <style>
Â  Â  /* ÑƒĞ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¾ĞºÑ€ÑƒÑ‚ĞºÑƒ/Ğ¾Ğ²ĞµÑ€ÑĞºÑ€Ğ¾Ğ»Ğ» Ğ¸ Ğ¶ĞµÑÑ‚Ñ‹ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ */
Â  Â  html, body {
Â  Â  Â  height:100%;
Â  Â  Â  margin:0;
Â  Â  Â  background:#000;
Â  Â  Â  color:#fff;
Â  Â  Â  font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
Â  Â  Â  overflow:hidden;
Â  Â  Â  overscroll-behavior:none;
Â  Â  Â  touch-action:none;
Â  Â  }

Â  Â  #permission-screen {
Â  Â  Â  position:fixed; inset:0;
Â  Â  Â  display:flex; flex-direction:column;
Â  Â  Â  align-items:center; justify-content:center;
Â  Â  Â  gap:16px; background:#000;
Â  Â  Â  z-index:10; padding:24px; text-align:center;
Â  Â  }

Â  Â  #button_loader, .downloadButton, .questionButton {
Â  Â  Â  padding:10px 16px;
Â  Â  Â  border:1px solid #fff;
Â  Â  Â  background:transparent;
Â  Â  Â  color:#fff;
Â  Â  Â  border-radius:8px;
Â  Â  Â  cursor:pointer;
Â  Â  }

Â  Â  #container {
Â  Â  Â  position:fixed; inset:0;
Â  Â  Â  display:none;
Â  Â  Â  touch-action:none;
Â  Â  }

Â  Â  #about {
Â  Â  Â  position:fixed;
Â  Â  Â  right:12px; bottom:12px;
Â  Â  }

Â  Â  #aboutText {
Â  Â  Â  display:none;
Â  Â  Â  position:fixed;
Â  Â  Â  right:12px; bottom:60px;
Â  Â  Â  width:260px;
Â  Â  Â  background:rgba(0,0,0,.7);
Â  Â  Â  padding:12px;
Â  Â  Â  border-radius:8px;
Â  Â  Â  font-size:13px;
Â  Â  Â  line-height:1.4;
Â  Â  }

Â  Â  #download_div {
Â  Â  Â  position:fixed;
Â  Â  Â  left:12px; bottom:12px;
Â  Â  Â  display:none;
Â  Â  }

Â  Â  #discription {
Â  Â  Â  position:fixed;
Â  Â  Â  top:12px; left:12px;
Â  Â  Â  background:rgba(0,0,0,.35);
Â  Â  Â  padding:8px 10px;
Â  Â  Â  border-radius:8px;
Â  Â  Â  font-size:13px;
Â  Â  }

Â  Â  #loading-screen {
Â  Â  Â  position:fixed; inset:0;
Â  Â  Â  display:none;
Â  Â  Â  align-items:center; justify-content:center;
Â  Â  Â  background:#000; z-index:9;
Â  Â  }

Â  Â  #loading_gif {
Â  Â  Â  width:120px; height:120px;
Â  Â  Â  opacity:.8;
Â  Â  }

Â  Â  video {
Â  Â  Â  opacity:0;
Â  Â  Â  width:0; height:0;
Â  Â  Â  position:absolute; left:-9999px;
Â  Â  }

Â  Â  canvas { image-rendering:auto; }

Â  Â  a { color:#9ad1ff; }
Â  </style>
</head>

<body>

Â  <div id="loading-screen" class="wrapper">
Â  Â  <img id="loading_gif" src="Loading_G.gif" alt="Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°â€¦" />
Â  </div>

Â  <section id="permission-screen">
Â  Â  <div id="loader">
Â  Â  Â  <strong>ĞÑƒĞ¶Ğ½Ğ¾ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ Ğ½Ğ° ĞºĞ°Ğ¼ĞµÑ€Ñƒ</strong><br />
Â  Â  Â  ĞĞ°Ğ¶Ğ¼Ğ¸ Â«ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒÂ» Ğ¸ Ğ² Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğµ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ° Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸ Â«Ğ Ğ°Ğ·Ñ€ĞµÑˆĞ¸Ñ‚ÑŒÂ».<br />
Â  Â  Â  Ğ’Ğ¸Ğ´ĞµĞ¾ Ğ½Ğ¸ĞºÑƒĞ´Ğ° Ğ½Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ÑÑ.
Â  Â  </div>
Â  Â  <button id="button_loader">ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ</button>
Â  Â  <div style="opacity:.6; font-size:13px;">
Â  Â  Â  Ğ•ÑĞ»Ğ¸ Ğ²Ğ¸Ğ´Ğ¸ÑˆÑŒ Â«Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰Ñ‘Ğ½Â» â€” Ğ¾Ñ‚ĞºÑ€Ğ¾Ğ¹ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ÑĞ°Ğ¹Ñ‚Ğ° Ğ² Ğ°Ğ´Ñ€ĞµÑĞ½Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ¾ĞºĞµ Ğ¸ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞ¸ ĞºĞ°Ğ¼ĞµÑ€Ñƒ.
Â  Â  </div>
Â  </section>

Â  <div id="container"></div>

Â  Â  <canvas id="canvas04" width="512" height="512" style="display:none"></canvas>Â  Â  <canvas id="canvas01" width="512" height="512" style="display:none"></canvas>Â  Â  <canvas id="canvas02" width="512" height="256" style="display:none"></canvas>Â  Â  <canvas id="Mycanvas" width="512" height="512" style="display:none"></canvas>Â  Â  Â  <video autoplay muted playsinline id="video" width="480" height="640"></video>

Â  <div id="discription">Ñ‚Ğ°Ğ¿ â€” Ğ¿ĞµÑ€ĞµĞ¼ĞµÑˆĞ°Ñ‚ÑŒ ĞºÑƒĞ±Ñ‹ â€¢ Ğ´Ğ²Ğ¸Ğ³Ğ°Ğ¹ Ğ¿Ğ°Ğ»ÑŒÑ†ĞµĞ¼ â€” Ğ¼ĞµĞ½ÑÑ‚ÑŒ ÑƒĞ³Ğ¾Ğ» ĞºĞ°Ğ¼ĞµÑ€Ñ‹</div>

Â  <div id="about">
Â  Â  <div id="aboutText">
Â  Â  Â  <p class="explain"><b>ĞšÑƒĞ±-ÑĞµĞ»Ñ„Ğ¸</b> â€” 3D + Ğ´ĞµÑ‚ĞµĞºÑ†Ğ¸Ñ Ğ»Ğ¸Ñ†Ğ°. Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞ¹ Ğ¿ĞµÑ€ÑĞ¿ĞµĞºÑ‚Ğ¸Ğ²Ğ¾Ğ¹ Ğ¸ Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸ Ğ»ÑƒÑ‡ÑˆĞ¸Ğ¹ Ñ€Ğ°ĞºÑƒÑ€Ñ.</p>
Â  Â  Â  <p class="credits">
Â  Â  Â  Â  Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸:
Â  Â  Â  Â  <a href="https://threejs.org/">Three.js</a>,
Â  Â  Â  Â  <a href="https://developers.google.com/mediapipe/solutions/vision/face_mesh">MediaPipe FaceMesh</a>,
Â  Â  Â  Â  <a href="https://learn.ml5js.org/#/reference/posenet">ml5 PoseNet</a>
Â  Â  Â  </p>
Â  Â  </div>
Â  Â  <button class="questionButton" id="aboutButton">Ğ˜Ğ½Ñ„Ğ¾</button>
Â  </div>

Â  <div id="download_div">
Â  Â  <button class="downloadButton" id="download">Ğ¡Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ ÑĞ½Ğ¸Ğ¼Ğ¾Ğº</button>
Â  </div>

<script>
Â  // ===== Ğ³Ğ»ÑƒÑˆĞ¸Ğ¼ ÑĞºÑ€Ğ¾Ğ»Ğ»/ÑĞ²Ğ°Ğ¹Ğ¿Ñ‹ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ (Ğ½Ğ° Ğ²ÑÑĞºĞ¸Ğ¹ ÑĞ»ÑƒÑ‡Ğ°Ğ¹ Ğ¿Ğ¾Ğ¼Ğ¸Ğ¼Ğ¾ CSS) =====
Â  document.addEventListener('touchmove', e => e.preventDefault(), { passive:false });
Â  document.addEventListener('gesturestart', e => e.preventDefault(), { passive:false });

Â  // ===== DOM & helpers =====
Â  const video = document.getElementById("video");
Â  video.setAttribute('playsinline','true');
Â  video.setAttribute('muted','true');
Â  video.muted = true;

Â  const nose_canvasÂ  = document.getElementById("canvas04"); const ctxNoseÂ  = nose_canvas.getContext("2d");
Â  const left_canvasÂ  = document.getElementById("Mycanvas"); const ctxLEyeÂ  = left_canvas.getContext("2d");
Â  const right_canvas = document.getElementById("canvas01"); const ctxREyeÂ  = right_canvas.getContext("2d");
Â  const mouth_canvas = document.getElementById("canvas02"); const ctxMouth = mouth_canvas.getContext("2d");

Â  const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
Â  const rand=(a,b)=>Math.random()*(b-a)+a;

Â  // ===== Three.js =====
Â  let scene, renderer;
Â  let camera, orthoCamera, activeCamera;
Â  let cube01, cube02, cube03, cube04; // Ğ½Ğ¾Ñ, Ğ»ĞµĞ²Ñ‹Ğ¹ Ğ³Ğ»Ğ°Ğ·, Ğ¿Ñ€Ğ°Ğ²Ñ‹Ğ¹ Ğ³Ğ»Ğ°Ğ·, Ñ€Ğ¾Ñ‚
Â  const FIXED_Z = 0;

Â  // Â«ÑĞ²Ğ¾Ğ¸Â» Ğ¾Ñ€Ğ±Ğ¸Ñ‚-ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ñ‹ (zoom-out Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ)
Â  let radius = 600;Â  Â  Â  Â  Â  Â  Â // Ğ¾Ñ‚Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ ÑÑ†ĞµĞ½Ñ‹
Â  let azimuth = 0;Â  Â  Â  Â  Â  Â  Â  // Ğ³Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑƒĞ³Ğ¾Ğ»
Â  let polar = Math.PI/2;Â  Â  Â  Â  // Ğ²ĞµÑ€Ñ‚Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑƒĞ³Ğ¾Ğ»
Â  const polarMin = Math.PI/6;
Â  const polarMax = Math.PI*5/6;
Â  let dragging = false, lastX=0, lastY=0, dragStartTime=0, moved=false;

Â  // ===== Ğ›ĞµĞ½Ğ´Ğ¼Ğ°Ñ€ĞºĞ¸/Ğ±Ğ¾ĞºÑÑ‹ =====
Â  let firstPredictionCame = false;
Â  window._bbNose = null; window._bbLEye = null; window._bbREye = null; window._bbMouth = null;
Â  let noseX=0, noseY=0, leX=0, leY=0, reX=0, reY=0, mX=0, mY=0;

Â  // ===== UI =====
Â  $("#download").on("click", function(){
Â  Â  const dataURL = renderer.domElement.toDataURL("image/png");
Â  Â  const link = document.createElement("a");
Â  Â  link.download = "selfie.png"; link.href = dataURL; link.target = "_blank"; link.click();
Â  });

Â  $("#aboutButton").on("click", function(){
Â  Â  $("#aboutText").fadeToggle('fast');
Â  Â  $("#aboutButton").text(($("#aboutButton").text() === 'Ğ˜Ğ½Ñ„Ğ¾') ? 'Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ' : 'Ğ˜Ğ½Ñ„Ğ¾').fadeIn();
Â  });

Â  $("#container, #discription").on('touchstart mousedown', function(){
Â  Â  $("#discription").fadeOut('fast');
Â  });

Â  // ===== ĞšĞ°Ğ¼ĞµÑ€Ğ° + Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ =====
Â  async function askCamera() {
Â  Â  try {
Â  Â  Â  const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' }, audio:false });
Â  Â  Â  video.srcObject = stream;

Â  Â  Â  if (video.readyState < 1) await new Promise(r => (video.onloadedmetadata = r));
Â  Â  Â  await video.play();

Â  Â  Â  await new Promise(r=>setTimeout(r,50));
Â  Â  Â  video.widthÂ  = video.videoWidthÂ  || 480;
Â  Â  Â  video.height = video.videoHeight || 640;

Â  Â  Â  return true;
Â  Â  } catch (err) {
Â  Â  Â  console.error('[getUserMedia error]', err.name, err.message);
Â  Â  Â  const hints = {
Â  Â  Â  Â  NotAllowedError:Â  Â  'Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ğº ĞºĞ°Ğ¼ĞµÑ€Ğµ Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰Ñ‘Ğ½ Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ ÑĞ°Ğ¹Ñ‚Ğ°. Ğ Ğ°Ğ·Ñ€ĞµÑˆĞ¸ ĞºĞ°Ğ¼ĞµÑ€Ñƒ Ğ² Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ñ… ÑĞ°Ğ¹Ñ‚Ğ° Ğ¸ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ.',
Â  Â  Â  Â  NotFoundError:Â  Â  Â  'ĞšĞ°Ğ¼ĞµÑ€Ğ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°. ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸ ĞºĞ°Ğ¼ĞµÑ€Ñƒ Ğ¸Ğ»Ğ¸ Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸ ĞµÑ‘ Ğ² Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ñ… ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹/Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ°.',
Â  Â  Â  Â  NotReadableError:Â  Â 'ĞšĞ°Ğ¼ĞµÑ€Ğ° Ğ·Ğ°Ğ½ÑÑ‚Ğ° Ğ´Ñ€ÑƒĞ³Ğ¸Ğ¼ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸ĞµĞ¼. Ğ—Ğ°ĞºÑ€Ğ¾Ğ¹ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‰Ğ¸Ğµ ĞºĞ°Ğ¼ĞµÑ€Ñƒ, Ğ¸ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹ ÑĞ½Ğ¾Ğ²Ğ°.',
Â  Â  Â  Â  OverconstrainedError:'Ğ’Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ ĞºĞ°Ğ¼ĞµÑ€Ñ‹ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼.',
Â  Â  Â  Â  SecurityError:Â  Â  Â  'ĞÑƒĞ¶ĞµĞ½ HTTPS (Ğ¸Ğ»Ğ¸ http://localhost).',
Â  Â  Â  Â  TypeError:Â  Â  Â  Â  Â  'ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° Ğº ĞºĞ°Ğ¼ĞµÑ€Ğµ.'
Â  Â  Â  };
Â  Â  Â  alert(hints[err.name] || ('ĞÑˆĞ¸Ğ±ĞºĞ° ĞºĞ°Ğ¼ĞµÑ€Ñ‹: ' + err.message));
Â  Â  Â  return false;
Â  Â  }
Â  }

Â  // ===== ĞšĞ½Ğ¾Ğ¿ĞºĞ° Â«ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒÂ» =====
Â  $("#button_loader").on("click", async function(){
Â  Â  $("#permission-screen").fadeOut('slow');
Â  Â  $("#loading-screen").show();

Â  Â  const ok = await askCamera();
Â  Â  if (!ok) { $("#loading-screen").hide(); $("#permission-screen").show(); return; }

Â  Â  $("#container").fadeIn('slow');
Â  Â  $("#download_div").fadeIn('slow');
Â  Â  $("#aboutButton").fadeIn('slow');

Â  Â  initThree();
Â  Â  bootTrackers();
Â  Â  changePosition();
Â  Â  animate();

Â  Â  // Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¾ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ»Ğ¾Ğ°Ğ´ĞµÑ€ Ğ½Ğ° Ğ¿Ğ°Ñ€Ñƒ ÑĞµĞºÑƒĞ½Ğ´, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ²ÑÑ‘ ÑƒÑĞ¿ĞµĞ»Ğ¾ Ğ¿Ñ€Ğ¾Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒÑÑ
Â  Â  setTimeout(()=>$("#loading-screen").fadeOut('fast'), 2000);
Â  });

Â  // ===== Ğ¢Ñ€ĞµĞºĞµÑ€Ñ‹ =====
Â  function bootTrackers(){
Â  Â  // MediaPipe FaceMesh
Â  Â  try {
Â  Â  Â  const fm = new FaceMesh.FaceMesh({
Â  Â  Â  Â  locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`
Â  Â  Â  });
Â  Â  Â  fm.setOptions({
Â  Â  Â  Â  maxNumFaces: 1,
Â  Â  Â  Â  refineLandmarks: true,
Â  Â  Â  Â  minDetectionConfidence: 0.5,
Â  Â  Â  Â  minTrackingConfidence: 0.5
Â  Â  Â  });
Â  Â  Â  fm.onResults(onFaceMeshResults);
Â  Â  Â  let busy = false;
Â  Â  Â  (function pump(){
Â  Â  Â  Â  if (!busy && video.videoWidth){
Â  Â  Â  Â  Â  busy = true;
Â  Â  Â  Â  Â  fm.send({ image: video }).catch(()=>{}).finally(()=>{ busy=false; });
Â  Â  Â  Â  }
Â  Â  Â  Â  requestAnimationFrame(pump);
Â  Â  Â  })();
Â  Â  } catch(e) { console.warn('FaceMesh Ğ½Ğµ Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ğ»ÑÑ:', e); }

Â  Â  // PoseNet fallback
Â  Â  try {
Â  Â  Â  const net = ml5.poseNet(video, () => {});
Â  Â  Â  net.on('pose', onPoseNetResults);
Â  Â  } catch(e) { console.warn('PoseNet Ğ½Ğµ Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ğ»ÑÑ:', e); }
Â  }

Â  function onFaceMeshResults(res){
Â  Â  const faces = res.multiFaceLandmarks || [];
Â  Â  if (!faces.length) return;
Â  Â  firstPredictionCame = true;

Â  Â  const pts = faces[0];
Â  Â  const IDX = {
Â  Â  Â  leftEye:Â  [33,133,160,159,158,157,173],
Â  Â  Â  rightEye: [362,263,387,386,385,384,398],
Â  Â  Â  nose:Â  Â  Â [1,6,197,195,5,4,45],
Â  Â  Â  mouth:Â  Â  [78,95,88,178,87,14,317,308,324]
Â  Â  };

Â  Â  function bboxNorm(idxs){
Â  Â  Â  let minX=1,minY=1,maxX=0,maxY=0;
Â  Â  Â  for (const i of idxs){
Â  Â  Â  Â  const p=pts[i]; if(!p) continue; const x=p.x,y=p.y;
Â  Â  Â  Â  if(x<minX)minX=x; if(y<minY)minY=y;
Â  Â  Â  Â  if(x>maxX)maxX=x; if(y>maxY)maxY=y;
Â  Â  Â  }
Â  Â  Â  return {x:minX, y:minY, w:Math.max(1e-3,maxX-minX), h:Math.max(1e-3,maxY-minY)};
Â  Â  }
Â  Â  function toPixels(b, pad=0.03){
Â  Â  Â  const vw = video.videoWidth || video.width || 480;
Â  Â  Â  const vh = video.videoHeight || video.height || 640;
Â  Â  Â  const px = Math.max(0, b.x - pad) * vw;
Â  Â  Â  const py = Math.max(0, b.y - pad) * vh;
Â  Â  Â  const pw = Math.min(1, b.w + pad*2) * vw;
Â  Â  Â  const ph = Math.min(1, b.h + pad*2) * vh;
Â  Â  Â  return { x:px, y:py, w:pw, h:ph };
Â  Â  }

Â  Â  window._bbLEyeÂ  = toPixels(bboxNorm(IDX.leftEye),Â  0.04);
Â  Â  window._bbREyeÂ  = toPixels(bboxNorm(IDX.rightEye), 0.04);
Â  Â  window._bbNoseÂ  = toPixels(bboxNorm(IDX.nose),Â  Â  Â 0.05);
Â  Â  window._bbMouth = toPixels(bboxNorm(IDX.mouth),Â  Â  0.05);
Â  }

Â  function onPoseNetResults(res){
Â  Â  if (!res || !res.length) return;
Â  Â  const k = res[0].pose.keypoints;
Â  Â  const nX = k[0].position.x, nY = k[0].position.y;
Â  Â  const Lx = k[1].position.x, Ly = k[1].position.y;
Â  Â  const Rx = k[2].position.x, Ry = k[2].position.y;

Â  Â  const lerp=(a,b,t)=>a+(b-a)*Math.max(0,Math.min(1,t));
Â  Â  noseX = lerp(noseX,nX,.5); noseY = lerp(noseY,nY,.5);
Â  Â  leXÂ  Â = lerp(leXÂ  ,Lx,.5); leYÂ  Â = lerp(leYÂ  ,Ly,.5);
Â  Â  reXÂ  Â = lerp(reXÂ  ,Rx,.5); reYÂ  Â = lerp(reYÂ  ,Ry,.5);

Â  Â  const d = Math.hypot(noseX-leX, noseY-leY) || 120;
Â  Â  mX = lerp(mX,noseX,.5); mY = lerp(mY,noseY + d,.5);

Â  Â  const makeBox=(cx,cy,sz)=>({x:cx-sz/2, y:cy-sz/2, w:sz, h:sz});
Â  Â  const sz = Math.max(40, Math.min(300, d));
Â  Â  if (!firstPredictionCame) {
Â  Â  Â  window._bbNoseÂ  = makeBox(noseX, noseY, sz);
Â  Â  Â  window._bbLEyeÂ  = makeBox(leX,Â  Â leY,Â  Â sz);
Â  Â  Â  window._bbREyeÂ  = makeBox(reX,Â  Â reY,Â  Â sz);
Â  Â  Â  window._bbMouth = { x:mX - sz/2, y:mY - sz/2, w:sz, h:sz*0.5 };
Â  Â  }
Â  }

Â  // ===== Three setup (ĞºĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ñ‹Ğ¹ Â«Ğ¾Ñ€Ğ±Ğ¸Ñ‚Â» + zoom-out) =====
Â  function initThree(){
Â  Â  scene = new THREE.Scene();
Â  Â  scene.background = new THREE.Color(0x0b0b0b);

Â  Â  renderer = new THREE.WebGLRenderer({ antialias:true, preserveDrawingBuffer:true });
Â  Â  renderer.setPixelRatio(window.devicePixelRatio || 1);
Â  Â  renderer.setSize(window.innerWidth, window.innerHeight);
Â  Â  document.getElementById('container').appendChild(renderer.domElement);

Â  Â  const aspect = window.innerWidth / window.innerHeight;
Â  Â  camera = new THREE.PerspectiveCamera(35, aspect, 0.1, 2000);

Â  Â  updateCameraFromSpherical();
Â  Â  camera.lookAt(0,0,0);

Â  Â  const frustumSize = 400;
Â  Â  orthoCamera = new THREE.OrthographicCamera(
Â  Â  Â  -frustumSize*aspect/2, frustumSize*aspect/2,
Â  Â  Â  Â frustumSize/2, -frustumSize/2,
Â  Â  Â  Â 0.1, 2000
Â  Â  );
Â  Â  activeCamera = camera;

Â  Â  scene.add(new THREE.AmbientLight(0xffffff, 0.6));
Â  Â  const dir = new THREE.DirectionalLight(0xffffff, 0.6);
Â  Â  dir.position.set(300, 400, 500);
Â  Â  scene.add(dir);

Â  Â  // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ñ‚ĞµĞºÑÑ‚ÑƒÑ€Ñ‹ Ğ¸Ğ· ĞºĞ°Ğ½Ğ²Ğ°ÑĞ¾Ğ²
Â  Â  const texNoseÂ  = new THREE.CanvasTexture(nose_canvas);
Â  Â  const texLEyeÂ  = new THREE.CanvasTexture(left_canvas);
Â  Â  const texREyeÂ  = new THREE.CanvasTexture(right_canvas);
Â  Â  const texMouth = new THREE.CanvasTexture(mouth_canvas);

Â  Â  // ğŸ”¥ Ğ¡ĞĞ—Ğ”ĞĞ•Ğœ ĞœĞĞ¡Ğ¡Ğ˜Ğ’ ĞœĞĞ¢Ğ•Ğ Ğ˜ĞĞ›ĞĞ’ Ğ”Ğ›Ğ¯ 6 Ğ“Ğ ĞĞĞ•Ğ™
Â  Â  // ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ¾Ğ±ÑŠĞµĞºÑ‚ BoxGeometry Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ Ğ¸Ğ¼ĞµĞµÑ‚ 6 Ğ³Ñ€Ğ°Ğ½ĞµĞ¹:
Â  Â  // [0]: Ğ¿Ñ€Ğ°Ğ²Ğ°Ñ, [1]: Ğ»ĞµĞ²Ğ°Ñ, [2]: Ğ²ĞµÑ€Ñ…Ğ½ÑÑ, [3]: Ğ½Ğ¸Ğ¶Ğ½ÑÑ, [4]: Ğ¿ĞµÑ€ĞµĞ´Ğ½ÑÑ, [5]: Ğ·Ğ°Ğ´Ğ½ÑÑ
Â  Â  const materials = [
Â  Â  Â  new THREE.MeshBasicMaterial({ map: texREye }),Â  Â // ĞŸÑ€Ğ°Ğ²Ğ°Ñ (Ğ¿Ñ€Ğ°Ğ²Ñ‹Ğ¹ Ğ³Ğ»Ğ°Ğ·)
Â  Â  Â  new THREE.MeshBasicMaterial({ map: texLEye }),Â  Â // Ğ›ĞµĞ²Ğ°Ñ (Ğ»ĞµĞ²Ñ‹Ğ¹ Ğ³Ğ»Ğ°Ğ·)
Â  Â  Â  new THREE.MeshBasicMaterial({ map: texNose }),Â  Â  // Ğ’ĞµÑ€Ñ…Ğ½ÑÑ (Ğ½Ğ¾Ñ)
Â  Â  Â  new THREE.MeshBasicMaterial({ map: texMouth }),Â  Â // ĞĞ¸Ğ¶Ğ½ÑÑ (Ñ€Ğ¾Ñ‚)
Â  Â  Â  new THREE.MeshBasicMaterial({ map: texREye }),Â  Â // ĞŸĞµÑ€ĞµĞ´Ğ½ÑÑ (Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ Ğ¿Ñ€Ğ°Ğ²Ğ¾Ğ³Ğ¾ Ğ³Ğ»Ğ°Ğ·Ğ°)
Â  Â  Â  new THREE.MeshBasicMaterial({ map: texNose })Â  Â  // Ğ—Ğ°Ğ´Ğ½ÑÑ (Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ Ğ½Ğ¾ÑĞ°)
Â  Â  ];

Â  Â  // ğŸ”¥ Ğ˜Ğ¡ĞŸĞĞ›Ğ¬Ğ—Ğ£Ğ•Ğœ ĞœĞĞ¡Ğ¡Ğ˜Ğ’ ĞœĞĞ¢Ğ•Ğ Ğ˜ĞĞ›ĞĞ’ Ğ’ĞœĞ•Ğ¡Ğ¢Ğ ĞĞ”Ğ˜ĞĞĞ§ĞĞĞ“Ğ ĞœĞĞ¢Ğ•Ğ Ğ˜ĞĞ›Ğ
Â  Â  cube01 = new THREE.Mesh(new THREE.BoxGeometry(70, 90, 70), materials);
Â  Â  cube02 = new THREE.Mesh(new THREE.BoxGeometry(60, 60, 60), materials);
Â  Â  cube03 = new THREE.Mesh(new THREE.BoxGeometry(60, 60, 60), materials);
Â  Â  cube04 = new THREE.Mesh(new THREE.BoxGeometry(120,55, 55), materials);

Â  Â  [cube01, cube02, cube03, cube04].forEach(c=>{
Â  Â  Â  c.rotation.set(0,0,0);
Â  Â  Â  c.position.z = FIXED_Z;
Â  Â  Â  scene.add(c);
Â  Â  });

Â  Â  window.addEventListener('resize', onResize);

Â  Â  // Ğ–ĞµÑÑ‚Ñ‹: Ğ¿ĞµÑ€ĞµÑ‚Ğ°ÑĞºĞ¸Ğ²Ğ°Ğ½Ğ¸Ğµ â€” Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ ĞºĞ°Ğ¼ĞµÑ€Ñ‹; ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¸Ğ¹ Ñ‚Ğ°Ğ¿ â€” Ğ¿ĞµÑ€ĞµĞ¼ĞµÑˆĞ°Ñ‚ÑŒ
Â  Â  document.addEventListener('pointerdown', e=>{
Â  Â  Â  dragging=true; moved=false; dragStartTime=Date.now();
Â  Â  Â  lastX=e.clientX; lastY=e.clientY;
Â  Â  }, {passive:true});

Â  Â  document.addEventListener('pointermove', e=>{
Â  Â  Â  if(!dragging) return;
Â  Â  Â  const dx = e.clientX - lastX;
Â  Â  Â  const dy = e.clientY - lastY;
Â  Â  Â  if (Math.abs(dx)>2 || Math.abs(dy)>2) moved=true;

Â  Â  Â  const ROT_SPEED = 0.005;
Â  Â  Â  azimuth += dx * ROT_SPEED;
Â  Â  Â  polarÂ  Â -= dy * ROT_SPEED;
Â  Â  Â  polar = Math.max(polarMin, Math.min(polarMax, polar));

Â  Â  Â  lastX = e.clientX; lastY = e.clientY;
Â  Â  Â  updateCameraFromSpherical();
Â  Â  }, {passive:true});

Â  Â  document.addEventListener('pointerup', e=>{
Â  Â  Â  if(!dragging) return;
Â  Â  Â  const tap = !moved && (Date.now()-dragStartTime < 250);
Â  Â  Â  dragging=false;
Â  Â  Â  if (tap) onTap(e);
Â  Â  }, {passive:true});
Â  }

Â  function updateCameraFromSpherical(){
Â  Â  const sinP = Math.sin(polar), cosP = Math.cos(polar);
Â  Â  const sinA = Math.sin(azimuth), cosA = Math.cos(azimuth);
Â  Â  const x = radius * sinP * cosA;
Â  Â  const y = radius * cosP;
Â  Â  const z = radius * sinP * sinA;
Â  Â  camera.position.set(x,y,z);
Â  Â  camera.lookAt(0,0,0);
Â  }

Â  // Ğ Ğ°Ğ½Ğ´Ğ¾Ğ¼Ğ½Ğ¾Ğµ Ğ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ ĞºÑƒĞ±Ğ¾Ğ² ĞºĞ°Ğº Ğ² Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»Ğµ
Â  function changePosition(){
Â  Â  let d1=0,d2=0,d3=0,d4=0,d5=0,d6=0;
Â  Â  const F=(a,b)=>Math.hypot(a.x-b.x, a.y-b.y);
Â  Â  do{
Â  Â  Â  cube01.rotation.yÂ  = rand(0.1,0.5);
Â  Â  Â  cube02.rotation.yÂ  = rand(0.1,0.5);
Â  Â  Â  cube03.rotation.yÂ  = rand(0.1,0.5);
Â  Â  Â  cube04.rotation.yÂ  = rand(0.1,0.5);

Â  Â  Â  cube01.position.set(rand(-55,55),Â  rand(-140,140), 0);
Â  Â  Â  cube02.position.set(rand(-50,50),Â  rand(-150,150), 0);
Â  Â  Â  cube03.position.set(rand(-50,50),Â  rand(-150,150), 0);
Â  Â  Â  cube04.position.set(rand(-45,45),Â  rand(-155,155), 0);

Â  Â  Â  d1=F(cube01.position,cube02.position);
Â  Â  Â  d2=F(cube02.position,cube03.position);
Â  Â  Â  d3=F(cube01.position,cube03.position);
Â  Â  Â  d4=F(cube03.position,cube04.position);
Â  Â  Â  d5=F(cube02.position,cube04.position);
Â  Â  Â  d6=F(cube01.position,cube04.position);
Â  Â  } while (d1<100 || d2<100 || d3<100 || d4<100 || d5<100 || d6<100);
Â  }

Â  function onResize(){
Â  Â  const w = window.innerWidth, h = window.innerHeight, aspect = w/h;
Â  Â  camera.aspect = aspect; camera.updateProjectionMatrix();

Â  Â  const frustumSize = 400;
Â  Â  orthoCamera.left = -frustumSize*aspect/2;
Â  Â  orthoCamera.right =Â  frustumSize*aspect/2;
Â  Â  orthoCamera.top =Â  Â  frustumSize/2;
Â  Â  orthoCamera.bottom = -frustumSize/2;
Â  Â  orthoCamera.updateProjectionMatrix();

Â  Â  renderer.setSize(w,h);
Â  Â  updateCameraFromSpherical();
Â  }

Â  function onTap(e){
Â  Â  const downloadRect = document.getElementById("download_div").getBoundingClientRect();
Â  Â  const aboutRectÂ  Â  = document.getElementById("aboutButton").getBoundingClientRect();
Â  Â  const x = e.pageX || e.clientX, y = e.pageY || e.clientY;
Â  Â  const inDownload = x >= downloadRect.left-5 && x <= downloadRect.right+5 &&
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â y >= downloadRect.top-5Â  && y <= downloadRect.bottom+5;
Â  Â  const inAboutÂ  Â  = x >= aboutRect.left-5Â  Â  && x <= aboutRect.right+5 &&
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â y >= aboutRect.top-5Â  Â  Â && y <= aboutRect.bottom+5;
Â  Â  if (inDownload || inAbout) return;
Â  Â  changePosition();
Â  }

Â  // ===== Ğ ĞµĞ½Ğ´ĞµÑ€/Ğ½Ğ°Ñ€ĞµĞ·ĞºĞ° =====
Â  function drawFull(dstCtx, dw, dh){
Â  Â  try {
Â  Â  Â  dstCtx.drawImage(
Â  Â  Â  Â  video,
Â  Â  Â  Â  0, 0,
Â  Â  Â  Â  video.videoWidth || dw,
Â  Â  Â  Â  video.videoHeight || dh,
Â  Â  Â  Â  0, 0, dw, dh
Â  Â  Â  );
Â  Â  } catch(e){}
Â  }

Â  // ğŸ”¥ ĞĞ¾Ğ²Ñ‹Ğ¹ drawCrop: Ğ±ĞµÑ€Ñ‘Ğ¼ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ¾Ğ±Ğ»Ğ°ÑÑ‚Ğ¸ Ğ²Ğ¾ĞºÑ€ÑƒĞ³ Ñ‡Ğ°ÑÑ‚Ğ¸ Ğ»Ğ¸Ñ†Ğ° (ZOOM_OUT > 1)
Â  function drawCrop(dstCtx, b, dw, dh){
Â  Â  if (!b || !Number.isFinite(b.x) || !Number.isFinite(b.y)) {
Â  Â  Â  // ĞµÑĞ»Ğ¸ Ğ±Ğ¾ĞºÑĞ° Ğ½ĞµÑ‚ â€” Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ñ„ÑƒĞ»Ğ»-ĞºĞ°Ğ´Ñ€ ĞºĞ°Ğº Ñ€Ğ°Ğ½ÑŒÑˆĞµ
Â  Â  Â  drawFull(dstCtx, dw, dh);
Â  Â  Â  return;
Â  Â  }

Â  Â  const vw = video.videoWidth || video.width || 480;
Â  Â  const vh = video.videoHeight || video.height || 640;

Â  Â  // ĞºĞ¾ÑÑ„Ñ„Ğ¸Ñ†Ğ¸ĞµĞ½Ñ‚ "Ğ¾Ñ‚Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ":
Â  Â  // 1.0 = ĞºĞ°Ğº Ğ±Ñ‹Ğ»Ğ¾, 1.2 = Ğ²Ğ¸Ğ´Ğ½Ğ¾ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ»Ğ¸Ñ†Ğ° Ğ² ĞºÑƒĞ±Ğµ
Â  Â  const ZOOM_OUT = 1.2;

Â  Â  // Ñ†ĞµĞ½Ñ‚Ñ€ Ğ±Ğ¾ĞºÑĞ°
Â  Â  const cx = b.x + b.w / 2;
Â  Â  const cy = b.y + b.h / 2;

Â  Â  // Ñ€Ğ°ÑÑˆĞ¸Ñ€ÑĞµĞ¼ Ğ±Ğ¾ĞºÑ
Â  Â  let sw = b.w * ZOOM_OUT;
Â  Â  let sh = b.h * ZOOM_OUT;

Â  Â  let sx = cx - sw / 2;
Â  Â  let sy = cy - sh / 2;

Â  Â  // Ğ°ĞºĞºÑƒÑ€Ğ°Ñ‚Ğ½Ğ¾ Ğ¿Ğ¾Ğ´Ñ€ĞµĞ·Ğ°ĞµĞ¼ Ğ¿Ğ¾ ĞºÑ€Ğ°ÑĞ¼ Ğ²Ğ¸Ğ´ĞµĞ¾ĞºĞ°Ğ´Ñ€Ğ°
Â  Â  sx = clamp(sx, 0, vw - 1);
Â  Â  sy = clamp(sy, 0, vh - 1);
Â  Â  sw = clamp(sw, 1, vw - sx);
Â  Â  sh = clamp(sh, 1, vh - sy);

Â  Â  try {
Â  Â  Â  dstCtx.drawImage(video, sx, sy, sw, sh, 0, 0, dw, dh);
Â  Â  } catch(e){}
Â  }

Â  function animate(){
Â  Â  requestAnimationFrame(animate);

Â  Â  const hasLM = (_bbNose || _bbLEye || _bbREye || _bbMouth);
Â  Â  if (hasLM) {
Â  Â  Â  drawCrop(ctxNose,Â  _bbNose,Â  nose_canvas.width,Â  nose_canvas.height);
Â  Â  Â  drawCrop(ctxLEye,Â  _bbLEye,Â  left_canvas.width,Â  left_canvas.height);
Â  Â  Â  drawCrop(ctxREye,Â  _bbREye,Â  right_canvas.width, right_canvas.height);
Â  Â  Â  drawCrop(ctxMouth, _bbMouth, mouth_canvas.width, mouth_canvas.height);
Â  Â  } else {
Â  Â  Â  drawFull(ctxNose,Â  nose_canvas.width,Â  nose_canvas.height);
Â  Â  Â  drawFull(ctxLEye,Â  left_canvas.width,Â  left_canvas.height);
Â  Â  Â  drawFull(ctxREye,Â  right_canvas.width, right_canvas.height);
Â  Â  Â  drawFull(ctxMouth, mouth_canvas.width, mouth_canvas.height);
Â  Â  }

Â  Â  // ğŸ”¥ Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞĞ«Ğ™ ĞšĞĞ” Ğ”Ğ›Ğ¯ ĞĞ‘ĞĞĞ’Ğ›Ğ•ĞĞ˜Ğ¯ Ğ’Ğ¡Ğ•Ğ¥ Ğ¢Ğ•ĞšĞ¡Ğ¢Ğ£Ğ  Ğ“Ğ ĞĞĞ•Ğ™
Â  Â  // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ»Ğ¸ material Ğ¼Ğ°ÑÑĞ¸Ğ²Ğ¾Ğ¼ (Ğ´Ğ»Ñ 6 Ğ³Ñ€Ğ°Ğ½ĞµĞ¹) Ğ¸Ğ»Ğ¸ Ğ¾Ğ´Ğ¸Ğ½Ğ¾Ñ‡Ğ½Ñ‹Ğ¼ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ¼
Â  Â  const materials = Array.isArray(cube01.material) ? cube01.material : [cube01.material];

Â  Â  // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ĞºĞ°Ñ€Ñ‚Ñ‹ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ğ´Ğ¸Ğ½ Ñ€Ğ°Ğ·, Ñ‚Ğ°Ğº ĞºĞ°Ğº Ğ²ÑĞµ ĞºÑƒĞ±Ñ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ Ğ¾Ğ´Ğ½Ğ¸ Ğ¸ Ñ‚Ğµ Ğ¶Ğµ 4 CanvasTexture,
Â  Â  // Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ² Ñ€Ğ°Ğ·Ğ½Ğ¾Ğ¼ Ğ¿Ğ¾Ñ€ÑĞ´ĞºĞµ Ğ² Ğ¼Ğ°ÑÑĞ¸Ğ²Ğµ. Ğ”Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‚Ğµ CanvasTexture,
Â  Â  // ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ±Ñ‹Ğ»Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹ Ğ¸Ğ· ĞºĞ°Ğ½Ğ²Ğ°ÑĞ¾Ğ² (texNose, texLEye, texREye, texMouth).
Â  Â 
Â  Â  // ĞœÑ‹ Ğ±ÑƒĞ´ĞµĞ¼ Ğ¸ÑĞºĞ°Ñ‚ÑŒ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ CanvasTexture Ğ² Ğ¼Ğ°ÑÑĞ¸Ğ²Ğµ Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ğ¾Ğ²:
Â  Â  const texturesToUpdate = new Set();
Â  Â  materials.forEach(mat => {
Â  Â  Â  if (mat && mat.map && mat.map.isCanvasTexture) {
Â  Â  Â  Â  texturesToUpdate.add(mat.map);
Â  Â  Â  }
Â  Â  });

Â  Â  // Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ñ‚ĞµĞºÑÑ‚ÑƒÑ€Ñ‹
Â  Â  texturesToUpdate.forEach(map => {
Â  Â  Â  map.needsUpdate = true;
Â  Â  });


Â  Â  activeCamera.lookAt(0,0,0);
Â  Â  renderer.render(scene, activeCamera);
Â  }
</script>
</body>
</html>
